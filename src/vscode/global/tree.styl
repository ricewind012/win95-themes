$icon-width = 16px;
$max-nest   = 10;

/**
 * Attributes
 *
 * aria-expanded | directory, if present
 * aria-level    | how deep it is
**/

[aria-level]:not([aria-level="1"]) {
	--a: 36px;
	--b: 12px;
	--b-with-arrow: 24px;

	&:not([aria-expanded]) {
		--b: var(--b-with-arrow);
	}

	.monaco-tl-twistie {
		padding-left: calc(var(--a) + var(--b) * (var(--level) - var(--multiply)));
		margin-left: var(--offset);
	}
}

for i in range(2, $max-nest) {
	{s('[aria-level="%s"]', i)} {
		--level: i;
		--multiply: 3 - (0.5 * i);
		--offset: 2px * (i - 6);

		&:not([aria-expanded]) {
			--offset: -16px * (i - 3);
		}
	}
}

// God knows why these need an override ...
[aria-level="2"] {
	--multiply: 2.5;
	--offset: -2px;

	&:not([aria-expanded]) {
		--multiply: 1.35;
		--offset: 0px;
	}
}

[aria-level="3"] {
	--multiply: 2;
	--offset: 0px;

	&:not([aria-expanded]) {
		--offset: 12px;
	}
}

[aria-level="4"] {
	--offset: -4px;
}

[role="treeitem"] {
	padding-left: 4px;

	&[aria-selected="true"] {
		background-color: var(--color-window);
		color: var(--color-window-text);

		.monaco-icon-name-container {
			background-color: var(--color-highlight);
			color: var(--color-highlight-text);
			border: 1px dotted #ff0;
		}
	}

	.monaco-icon {
		&-label {
			align-items: center;

			&::before {
				padding-right: 2px;

				// Fix for source control tab or the extension
				height: 16px;
				z-index: 2;
			}

			&::after {
				opacity: 1;

				margin: 0 4px;

				width: 12px;
			}

			&-container {
				margin-top: 1px;
			}
		}

		&-name-container {
			padding: 1px 5px 0 1px;

			.label-separator {
				opacity: 1;

				margin: 0;
			}
		}
	}
}

// Tree dots
.monaco-tl {
	&-row {
		overflow: visible;

		margin-left: -12px;
	}

	&-contents {
		overflow: visible;

		position: relative;

		// Expand button to icon dots
		&::before,
		[aria-expanded] &::after {
			content: '';

			position: absolute;
		}

		&::before {
			border-bottom: 1px dotted var(--color-tree-border);

			left: -6px;
			top: 50%;
			width: 7px;
		}

		// Doesn't work in search :/
		[aria-expanded]:not([data-index="0"]) &::after {
			border-right: 1px dotted var(--color-tree-border);

			left: -12px;
			bottom: calc(50% + 5px);
			height: 7px;
		}
	}

	&-twistie {
		padding-right: 4px;

		&,
		&::before {
			transform: unset;
		}

		&::before {
			--color-button-text: var(--color-window-text);

			z-index: 2;
		}

		[aria-expanded] &::after {
			content: '';

			background-color: var(--color-window);
			border: 1px solid var(--color-tree-border);

			position: absolute;
			box(7px);
			z-index: 1;
		}
	}

	&-indent {
		top: -18px;
		height: calc(100% + 22px);

		& > .indent-guide {
			border-left: 1px dotted var(--color-tree-border);

			width: $icon-width + 4px;
			height: calc(100% - 1px);
		}
	}
}

// Icons
.show-file-icons [role="treeitem"] {
	.file-icon::before {
		content: '';

		background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAQCAMAAAD6fQULAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAPUExURQAAAP///4eIj8DHyAAAAIf7VzIAAAAFdFJOU/////8A+7YOUwAAAAlwSFlzAAAOwwAADsMBx2+oZAAAADZJREFUGFdjYGFhYIRCIBPIYYJCIBtIICCQBwfMWHgMDCBFOOVA0lSVgwEQjxkBGIDuhgMGFgBmBADr9EYr2gAAAABJRU5ErkJggg==');
		background-size: 13px 16px;
		background-position: center;
	}

	&[aria-expanded] .monaco-icon-label::before {
		content: '';

		background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAANCAMAAABBwMRzAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAASUExURYeIj8DHyP//AP///wAAAAAAAJRqB2kAAAAGdFJOU///////ALO/pL8AAAAJcEhZcwAADsMAAA7DAcdvqGQAAAA1SURBVBhXtYrRFQAQEMOCdv+VHcfDANKvtMVm4AWm1MguSI0ib9AuUHjuM9OPlh/7g7AupA6lNwF/p6NMjAAAAABJRU5ErkJggg==');
	}
}

// Overrides for files not at first level
[role="treeitem"]:not([aria-expanded]):not([aria-level="1"]) {
	.monaco-tl-contents::before {
		border-left: 1px dotted var(--color-tree-border);
		border-bottom: 1px dotted var(--color-tree-border);

		left: $icon-width * -1;
		top: -50%;
		width: $icon-width - 4px;
		height: 100%;
		z-index: 1;
	}

	.explorer-folders-view & .monaco-icon-label {
		margin-left: -5px;
	}

	.search-view & {
		&[aria-level="2"] {
			--multiply: 2.25;
			--b: 12px;
		}

		&[data-last-element="true"] .monaco-tl-indent {
			display: none;
		}
	}
}

// Panel
.tree-container {
	[aria-level="2"]:not([aria-expanded]) {
		--multiply: 2.25;
	}

	.indent-guide {
		visibility: hidden;
	}

	[aria-expanded] .resource-label-container {
		margin-left: -3px;
	}
}

// Settings
.settings-toc-container {
	[aria-level="2"]:first-child {
		--multiply: 3;

		.monaco-tl-contents::before {
			display: none;
		}
	}
}